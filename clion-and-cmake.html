<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Limeoats | CLion, CMake, and Statically Linked Libraries</title>
    <link rel="canonical" href="http://www.limeoats.com/clion-and-cmake.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="stylesheet" href="stylesheets/syntaxhighlight.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="images/favicon/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/favicon/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="images/favicon/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="images/favicon/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="images/favicon/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="images/favicon/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="images/favicon/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="images/favicon/pple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="images/favicon/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="images/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="images/favicon/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="images/favicon/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="images/favicon/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="&nbsp;"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="images/favicon/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="images/favicon/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="images/favicon/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="images/favicon/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="images/favicon/mstile-310x310.png" />
    <meta name="theme-color" content="#ffffff">
    <meta name="description" content="Learn how to create static libraries and link to them in CLion with CMake.">
    <meta name="author" content="Limeoats">

    <script src="javascripts/highlight.pack.js"></script>
    <script src="javascripts/main.js" type="text/javascript"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    <script>
        //Google analytics
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-78321209-1', 'auto');
        ga('send', 'pageview');
    </script>
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name"><a href="index.html">Limeoats</a></h1>
      <h2 class="project-tagline">Mark Guerra</h2>
      <div class="project-icons">
        <a href="https://www.twitter.com/limeoats" target="_blank"><img src="images/twitter-icon.png" title="Twitter" /></a>
        <a href="https://www.youtube.com/channel/UC1azHQrx_NgGnEv5KUZB2jA" target="_blank"><img src="images/youtube-icon.png" title="Youtube" /></a>
        <a href="https://www.patreon.com/limeoats" target="_blank"><img src="images/patreon-icon.png" title="Patreon" id="patreonButton" /></a>
        <a href="https://www.github.com/limeoats" target="_blank"><img src="images/github-icon.png" title="Github" /></a>
        <a href="https://www.linkedin.com/pub/mark-guerra/66/a6a/107" target="_blank"><img src="images/linkedin-icon.png" title="LinkedIn" /></a>
        <a href="https://discord.gg/0g6ksoTuyf4TJKqh" target="_blank"><img src="images/discord-icon.png" title="Discord" id="discordButton" /></a>
      </div>
    </section>
    <section class="main-content">
      <div>
        <h2>CLion, CMake, and Statically Linked Libraries</h2>
      </div>
      <br/>
      <p>
          If you're in the process of working on a project in C++, then you have probably recently made a bunch of decisions regarding 
          which operating system to use, which IDE to use, and which compiler to use. 
          <br/><br/>
          The issue is that there are very few IDE / build process options that can be used [almost] universally among all major operating systems.           
          <br/><br/>
          The <strong>best option</strong> I have found is to use <a href="https://www.jetbrains.com/clion/" target="_blank">JetBrains CLion</a> in conjunction with 
          <a href="https://cmake.org/" target="_blank">CMake</a> to handle the build process. You will still need your own compiler, which may lead 
          to some inconsistencies down the road, but CLion and CMake are the closest you will be able to get to a cross platform C++ solution.
          <br/><br/>
          <h3>Why CLion and CMake?</h3>  
          I spent a <strong>tremendous</strong> amount of time bouncing between different C++ IDEs because I could not find anything that satisfied my 
          needs. Being able to develop my C++ projects on both my Windows PC and my iMac is very important to me. Therefore, operating system specific 
          IDEs like Microsoft's Visual Studio and Apple's XCode were off the table immediately. After years of being unsatisfied with the available options, 
          JetBrains CLion was released and all of my problems were immediately solved.
          <br/><br/>
          According to CLion's website, "<em>CLion project model is based on CMake - the cross-platform automatic build system. CMake itself doesn't build a project 
          but passes the build rules and targets listed in CMakeLists.txt file to a specific builder.</em>"
          <br/>
          CMake is built right into CLion, which makes it the obvious tool for the job. As the quote above mentions, though, CMake does not actually compile the 
          C++ code. You still need your own compiler to do that.
          <br/><br/>
          Since CLion and CMake both have cross-platform implementations, you can simply set up a C++ project in CLion, upload it to Github or another 
          remote repository, and then pull it down on a different operating system and continue developing. This feature alone makes it more 
          convenient and easy to use than Visual Studio, XCode, or even a text editor with GNU Make.
          <br/><br/>
          <h3>CMakeLists.txt</h3>
          If you are familiar with Makefiles, then you know that dealing with targets and includes can be very messy and frustrating. CMake takes care 
          of that through the use of a special file called <strong>CMakeLists.txt</strong>. This file can contain everything from compiler options, 
          libraries to link to, include directories, source files, and much more.
          <br/><br/>
          <h3>Mini Tutorial 1: Creating a static library</h3>
          I am going to walk you through the steps for creating a static library with CLion and CMake. In the next mini tutorial, we will be linking to this static 
          library from a different project.
          <br/><br/><strong>Note: You must have a compiler installed before starting this tutorial. On Windows, I use MinGW. On Mac, I use Clang.</strong>
          <br/><br/>
          Start by creating a new CLion project. Before you do anything else, navigate to the project's folder you just created and drop the header(s) and 
          implementation file(s) for the static library you want to create right next to main.cpp.
          <br/><br/>
          <img src="images/clion-and-cmake/files-in-folder-1.png" alt="Files in folder" />
          <br/><br/>
          Go back into CLion and you should see the files you just added on the left side in the Project window.
          <br/><br/>
          It's time to edit CMakeLists.txt to tell the compiler to create a static library out of our files. If you have never seen a CMakeLists.txt file before, 
          you'll notice that it isn't nearly as cryptic as a Makefile. The instructions are real words that are very easy to understand. This is what the default 
          instructions mean:
          <br/><br/>
          <img src="images/clion-and-cmake/cmakelists-default-1.png" alt="CMakeLists default" />
          <ul>
            <li><strong>cmake_minimum_required</strong>: The minimum required version of CMake that must be installed before compiling</li>
            <li><strong>project</strong>: The name of the project. You can set this to anything you'd like</li>
            <li><strong>set(CMAKE_CXX_FLAGS)</strong>: Setting the options that will be sent to your compiler. You can put the version of C++, warning ignores, and more here</li>
            <li><strong>set(SOURCE_FILES)</strong>: All of the source files in your project. You do not need to put the header files. You can if you want to, but you are only required to put implementation files here</li>
            <li><strong>add_executable</strong>: The command to create an executable. This command will actually be changed for creating a library instead of an executable</li>
          </ul>
          Let's modify some of these instructions so that a static library will be created.
          <br/><br/>
          In the <strong>set(SOURCE_FILES)</strong> instruction, add your new library's implementation file(s) after main.cpp. Then, change <strong>add_executable</strong> 
          to <strong>add_library</strong>.
          <br/><br/>
          When you're done, it should look something like this:
          <br/><br/>
          <img src="images/clion-and-cmake/cmakelists-create-library-1.png" alt="CMakeLists Create Library" />
          <br/><br/>
          Make sure you reload the CMake project (you can do this by either clicking Enable Auto-Reload at the top-right of CLion when it gives you the option OR 
          by right-clicking the CMakeLists.txt in the Project window on the left and selecting Reload CMake Project).<br/>
          Then, compile the project. You should see something like this in the output window if it worked:<br/><br/>
          <img src="images/clion-and-cmake/build-static-library-compile-1.png" alt="Build static library compile" />
          <br/><br/>
          And that's it! You can now navigate to the debug folder (mine's in a very obscure place: C:\Users\Limeoats\.CLion2016.1\system\cmake\generated\tinyxml2-6d774863\6d774863\Debug) 
          and grab the <strong>.a</strong> file that was generated.
          <br/><br/>
          <h3>Mini Tutorial 2: Linking to our new static library</h3>
          Start off by creating a new folder somewhere where you will place your library files. Inside, create two new folders, <strong>lib</strong> and <strong>include</strong>.
          <br/><br/>
          <img src="images/clion-and-cmake/lib-and-include-1.png" alt="Lib and include" />
          <br/><br/>
          Inside the lib folder, put the new <strong>.a</strong> file created in the previous mini tutorial.<br/>
          Inside the include folder, put the header file(s) from the library.
          <br/><br/>
          Next, open up or create the project you want to include this library in. The first thing we need to do is create a cmake file that will look for 
          our new library. You can technically hard-code the path to it in your CMakeLists file, but creating a separate file to look for it is a better approach.
          <br/><br/>
          At the root of the project, create a new folder called <strong>cmake</strong>. Inside that folder, create a new file called <strong>Find[YourLibrary].cmake</strong>. 
          My file will be called <strong>FindTinyXML2.cmake</strong>.
          <br/><br/>
          <img src="images/clion-and-cmake/create-cmake-file.png" alt="Create CMake file" />
          <br/><br/>
          In the code below, you will want to replace <strong>tinyxml2</strong> with whatever the name of your library is.
          <br/><br/>
          <pre><code class="python">
#The places to look for the tinyxml2 folders
set(FIND_TINYXML2_PATHS
        C:/tinyxml2                         #On Windows, this is where my tinyxml2 folder is
        ~/Libary/Frameworks/tinyxml2        #On Mac, this is where my tinyxml2 folder is
    )

#The location of the include folder (and thus the header files)
#find_path uses the paths we defined above as places to look
#Saves the location of the header files in a variable called TINYXML2_INCLUDE_DIR
find_path(TINYXML2_INCLUDE_DIR tinyxml2.h   #The variable to store the path in and the name of the header files
        PATH_SUFFIXES include               #The folder name containing the header files
        PATHS ${FIND_TINYXML2_PATHS})       #Where to look (defined above)

#The location of the lib folder (and thus the .a file)
#find_library uses the paths we defined above as places to look
#Saves the location of the .a file in a variable called TINYXML2_LIBRARY
find_library(TINYXML2_LIBRARY               #The variable to store where it found the .a files
        NAMES tinyxml2                      #The name of the .a file (without the extension and without the 'lib')
        PATH_SUFFIXES lib                   #The folder the .a file is in
        PATHS ${FIND_TINYXML2_PATHS})       #Where to look (defined above)
            </code>
            </pre>
        <br/><br/>
        Now all that's left is to use this CMake file from our CMakeLists.txt and the library will be linked to and ready to go!
        <br/><br/>
        Open up CMakeLists.txt. After the line where you set your CMAKE_CXX_FLAGS, add the following line:
        <br/><br/>
        <pre><code class="python">list(APPEND CMAKE_MODULE_PATH "${CMAKE_CURRENT_LIST_DIR}/cmake") #CMAKE_CURRENT_LIST_DIR is the directory holding the CMakeLists.txt we are currently using</code></pre>
        <br/><br/>
        As the comment says, ${CMAKE_CURRENT_LIST_DIR} is the directory that your CMakeLists.txt file is in. This line tells CMake where the FindTinyXML2.cmake file is located.
        <br/><br/>
        Next, add the following lines after the add_executable line:
        <br/><br/>
        <pre><code class="python">
include(FindPkgConfig)
find_package(Tinyxml2 REQUIRED)
include_directories(${TINYXML2_INCLUDE_DIR})
target_link_libraries(${PROJECT_NAME} ${TINYXML2_LIBRARY})
        </code></pre>
        <br/><br/>
        As always, replace the variables above with the ones you created in your FindLibrary.cmake file from before. <br/><br/>
        Once all of this is done, reload your CMake project and try to build. You should not get any linker errors. You can now include 
        the library's header file in main.cpp and use it like any other static library!
        <br/><br/>
        Happy developing :-)
        <br/><br/>
        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://www.limeoats.com/clion-and-cmake.html" data-via="Limeoats">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        <br/>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES * * */
            var disqus_shortname = 'limeoats';
            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
      <div>
      </p>
    </section>
  </body>
</html>